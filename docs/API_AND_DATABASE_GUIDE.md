# QuickPM API é…ç½®å’Œæ•°æ®åº“è®¾è®¡è¯´æ˜

## ä¸€ã€AI API é…ç½®çŠ¶æ€ âœ…

### 1. å½“å‰ä½¿ç”¨çš„ AI æœåŠ¡ï¼šFirebase Vertex AI (Gemini)

**é…ç½®ä½ç½®ï¼š** `lib/core/services/content_generator_service.dart`

**å½“å‰çŠ¶æ€ï¼š** âœ… å·²é…ç½®å¹¶å¯ç”¨

```dart
_model = FirebaseVertexAI.instance.generativeModel(
  model: 'gemini-1.5-flash', // å¿«é€Ÿä¸”æˆæœ¬ä½
  generationConfig: GenerationConfig(
    responseMimeType: 'application/json',
  ),
);
```

### 2. ä¸ºä»€ä¹ˆé€‰æ‹© Firebase Vertex AIï¼Ÿ

- âœ… **æ— éœ€é¢å¤– API Key**ï¼šä½¿ç”¨ Firebase é¡¹ç›®è‡ªå¸¦çš„é…é¢
- âœ… **è‡ªåŠ¨è®¤è¯**ï¼šé€šè¿‡ Firebase SDK è‡ªåŠ¨å¤„ç†
- âœ… **å†…ç½®å®‰å…¨**ï¼šä¸ä¼šæš´éœ² API Key åœ¨å®¢æˆ·ç«¯
- âœ… **å…è´¹é¢åº¦**ï¼šæ¯å¤©æœ‰å¤§é‡å…è´¹è¯·æ±‚ï¼ˆé€‚åˆ MVPï¼‰

### 3. Firebase é¡¹ç›®é…ç½®

**é¡¹ç›® IDï¼š** `quickpm-8f9c9`
**API Keyï¼š** `AIzaSyBzqgEC2K7teYRsUpw5NMECQTJg3Afnnj0`
**å·²å¯ç”¨æœåŠ¡ï¼š**
- âœ… Firebase Authentication (åŒ¿åç™»å½•)
- âœ… Cloud Firestore (æ•°æ®åº“)
- âœ… Vertex AI (Gemini API)

**é…ç½®æ–‡ä»¶ï¼š** `lib/firebase_options.dart`

---

## äºŒã€æ•°æ®åº“è®¾è®¡çŠ¶æ€ ğŸ“Š

### 1. Firestore æ•°æ®åº“ç»“æ„

```
quickpm-8f9c9 (Firebase Project)
â”‚
â”œâ”€â”€ feed_items (Collection)  â† çŸ¥è¯†ç‚¹å­˜å‚¨
â”‚   â”œâ”€â”€ {itemId} (Document)
â”‚   â”‚   â”œâ”€â”€ id: string
â”‚   â”‚   â”œâ”€â”€ module: string (A/B/C/D)
â”‚   â”‚   â”œâ”€â”€ title: string
â”‚   â”‚   â”œâ”€â”€ category: string
â”‚   â”‚   â”œâ”€â”€ difficulty: string
â”‚   â”‚   â”œâ”€â”€ masteryLevel: string
â”‚   â”‚   â”œâ”€â”€ isFavorited: boolean
â”‚   â”‚   â”œâ”€â”€ nextReviewTime: timestamp
â”‚   â”‚   â”œâ”€â”€ pages: array (åŒ…å« markdown å†…å®¹ã€é—ªå¡ç­‰)
â”‚   â”‚   â””â”€â”€ createdAt: timestamp
â”‚   â”‚
â”‚   â””â”€â”€ ... (å…¶ä»–çŸ¥è¯†ç‚¹)
â”‚
â””â”€â”€ users (Collection) â† ç”¨æˆ·æ•°æ® (è§„åˆ’ä¸­)
    â””â”€â”€ {uid} (Document)
        â”œâ”€â”€ settings: object
        â”œâ”€â”€ dailyGoalMinutes: number
        â””â”€â”€ notes (SubCollection) â† ç”¨æˆ·ç¬”è®°
            â””â”€â”€ {noteId}
                â”œâ”€â”€ feedItemId: string
                â”œâ”€â”€ question: string
                â”œâ”€â”€ answer: string
                â””â”€â”€ createdAt: timestamp
```

### 2. æ•°æ®æœåŠ¡å±‚è®¾è®¡

**æ–‡ä»¶ï¼š** `lib/data/services/firestore_service.dart`

**å·²å®ç°çš„åŠŸèƒ½ï¼š**
- âœ… `fetchFeedItems(moduleId)` - è·å–æŒ‡å®šæ¨¡å—çš„çŸ¥è¯†ç‚¹
- âœ… `toggleFavorite()` - æ”¶è—/å–æ¶ˆæ”¶è—
- âœ… `seedInitialData()` - åˆå§‹æ•°æ®å¯¼å…¥
- âš ï¸ `saveUserNote()` - ä¿å­˜ç”¨æˆ·ç¬”è®°ï¼ˆå¾…å®Œå–„ï¼‰
- âš ï¸ `updateSRSStatus()` - æ›´æ–°é—´éš”å¤ä¹ çŠ¶æ€ï¼ˆå¾…å®Œå–„ï¼‰

### 3. å½“å‰ä½¿ç”¨æ¨¡å¼

**æ··åˆæ¨¡å¼ï¼š**
- âœ… å®˜æ–¹çŸ¥è¯†ç‚¹ï¼šä» Firestore è¯»å–
- âš ï¸ ç”¨æˆ·ç”Ÿæˆå†…å®¹ï¼šæš‚æ—¶åªåœ¨å†…å­˜ä¸­ï¼ˆåˆ·æ–°ä¼šä¸¢å¤±ï¼‰
- ğŸ”„ éœ€è¦å®Œå–„ï¼šå°† AI ç”Ÿæˆçš„çŸ¥è¯†ç‚¹æŒä¹…åŒ–åˆ° Firestore

---

## ä¸‰ã€ç”¨æˆ·å¿…é¡»ç™»å½•å—ï¼ŸğŸ”

### å½“å‰å®ç°ï¼šâœ… è‡ªåŠ¨åŒ¿åç™»å½•

**ä»£ç ä½ç½®ï¼š** `lib/main.dart` (ç¬¬ 24-34 è¡Œ)

```dart
// åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œ
final auth = FirebaseAuth.instance;
if (auth.currentUser == null) {
  await auth.signInAnonymously(); // åŒ¿åç™»å½•
  debugPrint("Signed in anonymously: ${auth.currentUser?.uid}");
}
```

### åŒ¿åç™»å½•çš„ç‰¹ç‚¹

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **ç”¨æˆ·ä½“éªŒ** | âœ… æ— éœ€æ³¨å†Œï¼Œç›´æ¥ä½¿ç”¨ |
| **æ•°æ®éš”ç¦»** | âœ… æ¯ä¸ªè®¾å¤‡æœ‰ç‹¬ç«‹çš„ UID |
| **æ•°æ®æŒä¹…** | âš ï¸ å¸è½½ App â†’ æ•°æ®ä¸¢å¤± |
| **å¤šè®¾å¤‡åŒæ­¥** | âŒ ä¸æ”¯æŒ |
| **å‡çº§è·¯å¾„** | âœ… å¯åç»­ç»‘å®šé‚®ç®±/Google è´¦å· |

### ä¸ºä»€ä¹ˆéœ€è¦ç™»å½•ï¼Ÿ

å³ä½¿æ˜¯åŒ¿åç™»å½•ï¼Œä¹Ÿèƒ½è§£å†³ï¼š
1. âœ… **Firestore å®‰å…¨è§„åˆ™**ï¼šéœ€è¦ `uid` æ¥æ§åˆ¶è°å¯ä»¥è¯»å†™æ•°æ®
2. âœ… **ç”¨æˆ·æ•°æ®éš”ç¦»**ï¼šæ¯ä¸ªç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
3. âœ… **AI ä½¿ç”¨é…é¢**ï¼šFirebase Vertex AI éœ€è¦è®¤è¯ç”¨æˆ·

---

## å››ã€ç”¨æˆ·ä¸Šä¼ æ•°æ®çš„å®Œæ•´æµç¨‹ ğŸ”„

### å½“å‰æµç¨‹ï¼ˆéƒ¨åˆ†å®ç°ï¼‰

```
ç”¨æˆ·æ“ä½œ                AIå¤„ç†                  æ•°æ®æŒä¹…åŒ–
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç‚¹å‡»      â”‚        â”‚ 2. è°ƒç”¨      â”‚         â”‚ 3. ä¿å­˜åˆ°    â”‚
â”‚ Add Material â”‚   â†’    â”‚ Gemini API  â”‚    â†’    â”‚ å†…å­˜ (ä¸´æ—¶) â”‚
â”‚             â”‚        â”‚ ç”ŸæˆçŸ¥è¯†ç‚¹   â”‚         â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                      â†“
                                               âš ï¸ åˆ·æ–°é¡µé¢ â†’ ä¸¢å¤±
```

### éœ€è¦æ”¹è¿›çš„æµç¨‹

```
ç”¨æˆ·æ“ä½œ                AIå¤„ç†                  æ•°æ®æŒä¹…åŒ–
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç‚¹å‡»      â”‚        â”‚ 2. è°ƒç”¨      â”‚         â”‚ 3. ä¿å­˜åˆ°    â”‚
â”‚ Add Material â”‚   â†’    â”‚ Gemini API  â”‚    â†’    â”‚ Firestore   â”‚
â”‚             â”‚        â”‚ ç”ŸæˆçŸ¥è¯†ç‚¹   â”‚         â”‚ âœ… æŒä¹…åŒ–    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                      â†“
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ users/{uid}/custom_items/   â”‚
                         â”‚ - ç»‘å®šåˆ°ç”¨æˆ· ID             â”‚
                         â”‚ - è·¨è®¾å¤‡åŒæ­¥ (æœªæ¥)        â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äº”ã€å¾…åŠäº‹é¡¹æ¸…å• ğŸ“

### ç«‹å³éœ€è¦å®Œå–„çš„åŠŸèƒ½

#### 1. å®Œå–„ AI ç”Ÿæˆå†…å®¹çš„æŒä¹…åŒ–
**æ–‡ä»¶ï¼š** `lib/features/lab/presentation/add_material_modal.dart`

**ç¬¬ 51-54 è¡Œï¼š**
```dart
// å½“å‰ä»£ç  (ä¸´æ—¶æ–¹æ¡ˆ)
// Note: In a real app we would save to Firestore here.
// For now we just add to the in-memory provider.
ref.read(feedProvider.notifier).state = [...currentItems, ..._generatedItems!];
```

**éœ€è¦æ”¹ä¸ºï¼š**
```dart
// ä¿å­˜åˆ° Firestore
final service = ref.read(dataServiceProvider);
for (var item in _generatedItems!) {
  await service.saveCustomFeedItem(item); // æ–°æ–¹æ³•
}

// ç„¶ååˆ·æ–° Provider
ref.read(feedProvider.notifier).refreshFromFirestore();
```

#### 2. åœ¨ FirestoreService ä¸­æ·»åŠ æ–°æ–¹æ³•
**æ–‡ä»¶ï¼š** `lib/data/services/firestore_service.dart`

éœ€è¦æ·»åŠ ï¼š
```dart
Future<void> saveCustomFeedItem(FeedItem item) async {
  final uid = FirebaseAuth.instance.currentUser?.uid;
  if (uid == null) throw Exception('User not logged in');
  
  await _db
    .collection('users')
    .doc(uid)
    .collection('custom_items')
    .doc(item.id)
    .set(item.toJson());
}
```

#### 3. å®Œå–„ç”¨æˆ·ç¬”è®°ä¿å­˜
**æ–‡ä»¶ï¼š** `lib/data/services/firestore_service.dart` (ç¬¬ 47-49 è¡Œ)

å½“å‰åªæœ‰ TODOï¼Œéœ€è¦å®ç°çœŸå®çš„ä¿å­˜é€»è¾‘ã€‚

---

## å…­ã€å¿«é€ŸéªŒè¯ AI åŠŸèƒ½ ğŸ§ª

### æµ‹è¯•æ­¥éª¤

1. **å¯åŠ¨åº”ç”¨**
   ```bash
   flutter run -d web-server --web-port 3000
   ```

2. **ç‚¹å‡» Add Material æŒ‰é’®**
   - æµ®åŠ¨æŒ‰é’® (å³ä¸‹è§’)
   - æˆ–çŸ¥è¯†å¡ç‰‡å†…çš„æŒ‰é’®

3. **ç²˜è´´æµ‹è¯•æ–‡æœ¬**
   ```
   äº§å“ç»ç†éœ€è¦æŒæ¡éœ€æ±‚åˆ†æã€ç”¨æˆ·ç ”ç©¶ã€åŸå‹è®¾è®¡å’Œæ•°æ®åˆ†æå››å¤§æ ¸å¿ƒèƒ½åŠ›ã€‚
   éœ€æ±‚åˆ†ææ˜¯äº§å“ç»ç†çš„åŸºæœ¬åŠŸï¼Œè¦å­¦ä¼šåŒºåˆ†çœŸéœ€æ±‚å’Œä¼ªéœ€æ±‚ã€‚
   ```

4. **ç‚¹å‡»"ç”ŸæˆçŸ¥è¯†å¡ç‰‡"**
   - âœ… ä¼šè°ƒç”¨ Gemini API
   - âœ… è¿”å›ç»“æ„åŒ–çš„çŸ¥è¯†ç‚¹
   - âš ï¸ ä¿å­˜ååˆ·æ–°é¡µé¢ä¼šä¸¢å¤±ï¼ˆå¾…ä¿®å¤ï¼‰

---

## ä¸ƒã€æ€»ç»“å›ç­”ä½ çš„ä¸‰ä¸ªé—®é¢˜ ğŸ’¡

### Q1: å¦‚ä½•é…ç½® AI çš„ APIï¼Ÿ
**A:** âœ… **å·²ç»é…ç½®å¥½äº†ï¼**
- ä½¿ç”¨ Firebase Vertex AI (Gemini)
- æ— éœ€é¢å¤–çš„ API Key
- é€šè¿‡ Firebase é¡¹ç›®è‡ªåŠ¨è®¤è¯
- ç›´æ¥å¯ç”¨ï¼Œæ— éœ€é¢å¤–é…ç½®

### Q2: ç”¨æˆ·ä¸Šä¼ åçš„æ•°æ®åº“è®¾è®¡åšå¥½äº†å—ï¼Ÿ
**A:** âš ï¸ **éƒ¨åˆ†å®Œæˆï¼Œéœ€è¦æ”¹è¿›**
- âœ… æ•°æ®åº“ç»“æ„å·²è®¾è®¡
- âœ… Firestore æœåŠ¡å±‚å·²æ­å»º
- âš ï¸ AI ç”Ÿæˆçš„å†…å®¹**æš‚æ—¶åªå­˜åœ¨å†…å­˜**
- âŒ åˆ·æ–°é¡µé¢ä¼šä¸¢å¤±
- ğŸ”§ éœ€è¦è¡¥å……æŒä¹…åŒ–é€»è¾‘

### Q3: æ˜¯å¦å¿…é¡»ç™»å½•ï¼Ÿ
**A:** âœ… **è‡ªåŠ¨å®Œæˆï¼Œç”¨æˆ·æ— æ„ŸçŸ¥**
- åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨åŒ¿åç™»å½•
- ä¸éœ€è¦ç”¨æˆ·æ‰‹åŠ¨æ³¨å†Œ
- å·²ç»æœ‰äº† UIDï¼Œå¯ä»¥ä¿å­˜ä¸ªäººæ•°æ®
- åç»­å¯å‡çº§ä¸ºæ­£å¼è´¦å·

---

## å…«ã€ä¸‹ä¸€æ­¥å»ºè®® ğŸ¯

1. **ç«‹å³ä¿®å¤ï¼š** å°† AI ç”Ÿæˆçš„å†…å®¹ä¿å­˜åˆ° Firestore
2. **ä¼˜åŒ–ä½“éªŒï¼š** æ·»åŠ åŠ è½½çŠ¶æ€å’Œé”™è¯¯æç¤º
3. **æœªæ¥è§„åˆ’ï¼š** æ”¯æŒé‚®ç®±ç™»å½•ï¼Œå®ç°å¤šè®¾å¤‡åŒæ­¥

éœ€è¦æˆ‘ç«‹å³å¸®ä½ å®ç°è¿™äº›æŒä¹…åŒ–åŠŸèƒ½å—ï¼Ÿ
