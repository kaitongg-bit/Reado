rules_version = '2';
service cloud.firestore {
  match /databases/reado/documents {
    // ğŸ’¡ çŸ¥è¯†ç‚¹åº“æ‰€æœ‰æƒæ¨¡å‹ï¼šæ‰€æœ‰äººå¯è¯»ï¼Œä»…ä¸»äººæˆ–ç®¡ç†å‘˜å¯å†™
    
    // 1. å®˜æ–¹å†…å®¹ (feed_items)
    match /feed_items/{itemId} {
      allow read: if true;
      allow write: if request.auth.uid == 'KAITONGG_UID';
    }

    // 2. ç”¨æˆ·æ•°æ® (users)
    match /users/{userId} {
      allow read: if true;
      // ä»…é™æœ¬äººæˆ–ç®¡ç†å‘˜ä¿®æ”¹åŸºæœ¬æ–‡æ¡£
      allow write: if request.auth != null && (request.auth.uid == userId || request.auth.uid == 'KAITONGG_UID');
      
      // ğŸ’¡ å…³é”®ä¿®å¤ï¼šå…è®¸å¢åŠ åˆ†äº«ç‚¹å‡»æ•°å’Œç§¯åˆ†ï¼ˆå³ä½¿æœªç™»å½•ï¼‰
      // è¿™æ˜¯ä¸ºäº†è®©åˆ†äº«å¥–åŠ±é€»è¾‘åœ¨è®¿å®¢ç‚¹å‡»æ—¶ä¹Ÿèƒ½ç”Ÿæ•ˆ
      allow update: if request.resource.data.diff(resource.data).affectedKeys()
        .hasAny(['shareClicks', 'credits', 'lastShareClickAt']);

      // ğŸ’¡ å­é›†åˆé€»è¾‘ï¼šæ¨¡å—ã€è‡ªå®šä¹‰é¡¹ç›®ã€ç¬”è®°ã€æŒæ¡æƒ…å†µç­‰
      match /{allSubcollections=**} {
        allow read: if true; // ğŸŒŸ æ‰€æœ‰äººå¯è¯»ï¼Œç¡®ä¿åˆ†äº«é“¾æ¥æœ‰æ•ˆ
        allow write: if request.auth != null && (request.auth.uid == userId || request.auth.uid == 'KAITONGG_UID');
      }
    }

    // 3. é€šç”¨è§„åˆ™
    match /{document=**} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.uid == 'KAITONGG_UID';
    }
  }
}
